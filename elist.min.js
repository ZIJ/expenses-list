(function(){function c(a){this.element=a?a:null}"use strict",window.elist||(window.elist={});var a=window.elist,b=window.document;a.ready=function(c){return b.addEventListener("DOMContentLoaded",c,!1),a},a.empty=function(a){var b=a.childNodes;for(var c=0;c<b.length;c+=1)a.removeChild(b[c]);return a},a.replace=function(a){var b={};return b.by=function(b){var c=a.parentNode,d=c&&typeof c=="object"&&typeof c.replaceChild=="function"&&a.parentNode===c;d&&c.replaceChild(b,a)},b},a.byId=function(a){var b=document.getElementById(a);return new c(b)},a.wrap=function(a){return new c(a)},c.prototype.isEmpty=function(){return!this.element},c.prototype.remove=function(){if(!this.isEmpty()){var a=this.element;a.parentNode.removeChild(a)}return this},c.prototype.append=function(a){if(!this.isEmpty()){var d=a instanceof c?a.element:a instanceof HTMLElement?a:b.createTextNode(a);this.element.appendChild(d)}return this}})(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.keyCodes={},a.keyCodes.ENTER=13,a.monthNames=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],Function.prototype.inheritFrom=function(a){var b=new a;this.prototype=b},a.report=function(a){throw new Error(a?a:"Something went wrong")},a.assert=function(b,c){b||a.report(c?c:"Assertion failed")}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.EventEmitter=function(){this.listeners={}},a.EventEmitter.prototype.on=function(a,b){this.listeners[a]instanceof Array||(this.listeners[a]=[]),this.listeners[a].indexOf(b)===-1&&this.listeners[a].push(b)},a.EventEmitter.prototype.off=function(a,b){if(this.listeners[a]instanceof Array){var c=this.listeners[a].indexOf(b);c!==-1&&this.listeners[a].splice(c,1)}},a.EventEmitter.prototype.emit=function(a,b){b=b||{};if(this.listeners[a]instanceof Array){var c=this.listeners[a].length;for(var d=0;d<c;d+=1)this.listeners[a][d](this,b)}}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.ObservableProperty=function(a){this.value=a,this.listeners={}},a.ObservableProperty.inheritFrom(a.EventEmitter),a.ObservableProperty.prototype.get=function(){return this.value},a.ObservableProperty.prototype.set=function(a){this.value!==a&&(this.value=a,this.emit("change"))},a.ObservableProperty.prototype.notify=function(a){this.on("change",a)},a.ObservableProperty.prototype.ignore=function(a){this.off("change",a)}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.ObservableCollection=function(){this.listeners={},this.items=[]},a.ObservableCollection.inheritFrom(a.EventEmitter),a.ObservableCollection.prototype.at=function(b){return(b<0||b>=this.items.length)&&a.report("Index out of bounds"),this.items[b]},a.ObservableCollection.prototype.has=function(a){return this.items.indexOf(a)>=0},a.ObservableCollection.prototype.count=function(){return this.items.length},a.ObservableCollection.prototype.add=function(a){return this.has(a)||(this.items.push(a),this.emit("change")),this},a.ObservableCollection.prototype.remove=function(a){var b=this.items.indexOf(a);return b>=0&&(this.items.splice(b,1),this.emit("change")),this},a.ObservableCollection.prototype.sortBy=function(a){return this.items.sort(a),this.emit("change"),this},a.ObservableCollection.prototype.orderBy=function(a,b){return this.sortBy(function(c,d){var e=0,f=a(c),g=a(d);return f>g?1:(f<g&&(e=-1),b?-e:e)})},a.ObservableCollection.prototype.each=function(a){for(var b=0;b<this.items.length;b+=1)a(this.items[b])},a.ObservableCollection.prototype.notify=function(a){this.on("change",a)},a.ObservableCollection.prototype.ignore=function(a){this.off("change",a)}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.BaseModel=function(a,b){},a.BaseModel.prototype.assign=function(b){typeof b!="object"&&a.report("Properties should be object");for(var c in b)b.hasOwnProperty(c)&&(this[c]instanceof a.ObservableProperty||a.report("No such ObservableProperty: "+c),this[c].set(b[c]))},a.BaseModel.prototype.newId=function(b){return typeof b!="number"?a.report("ID should be number"):b<0?a.report("ID should be positive"):b!==Math.floor(b)&&a.report("ID should be integer"),b},a.BaseModel.prototype.newProp=function(b){return new a.ObservableProperty(b)}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.BaseView=function(){this.listeners={},this.isVisible=!1},a.BaseView.inheritFrom(a.EventEmitter),a.BaseView.prototype.renderTo=function(a){return this.parentNode=a,this.show()},a.BaseView.prototype.show=function(){return this.isVisible||(this.parentNode||a.report("Parent node unknown. Call renderTo() first."),this.parentNode.appendChild(this.node),this.isVisible=!0),this},a.BaseView.prototype.hide=function(){if(this.isVisible&&this.parentNode){try{this.parentNode.removeChild(this.node)}catch(a){}this.isVisible=!1}}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.AppModel=function(b){var c=this;this.expenses=new a.ObservableCollection;for(var d=0;d<b.length;d+=1){var e=b[d].id,f=b[d].props,g=new a.ExpenseModel(e,f);this.expenses.add(g)}},a.AppModel.inheritFrom(a.BaseModel),a.AppModel.prototype.nextId=function(){var a=0;return this.expenses.each(function(b){a=Math.max(a,b.id)}),a+1},a.AppModel.prototype.createModel=function(){var b=new a.ExpenseModel(this.nextId());return this.expenses.add(b),b},a.AppModel.prototype.deleteModel=function(a){this.expenses.remove(a)}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.ExpenseModel=function(a,b){this.id=this.newId(a),this.description=this.newProp(""),this.amount=this.newProp(0),this.date=this.newProp(new Date),this.isActive=this.newProp(!0),b!==undefined&&this.assign(b)},a.ExpenseModel.inheritFrom(a.BaseModel)}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.AmountView=function(a){var b=this;this.listeners={},this.isVisible=!1,this.prop=a,this.parentNode=null,this.node=document.createElement("p"),this.node.addEventListener("dblclick",function(){b.emit("editRequest")},!1),this.prop.notify(function(){b.update()}),this.update()},a.AmountView.inheritFrom(a.BaseView),a.AmountView.prototype.update=function(){this.node.innerHTML="$"+this.prop.get()},a.AmountView.prototype.getValue=function(){return this.node.innerHTML}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.AppView=function(b){var c=b,d=this;this.listeners={},this.isVisible=!1,this.model=b,this.parentNode=null,this.invertSort=!1,this.totalActiveAmount=0,this.node=document.createElement("div"),this.bar=document.createElement("div"),this.node.appendChild(this.bar),this.createButton=new a.ButtonView("Создать"),this.createButton.renderTo(this.bar),this.createButton.on("press",function(){d.createExpense()}),this.searchLabel=document.createElement("label"),this.searchLabel.innerHTML="Поиск",this.bar.appendChild(this.searchLabel),this.searchInput=document.createElement("input"),this.searchInput.type="text",this.searchInput.addEventListener("input",function(){d.filter(d.searchInput.value)},!1),this.searchLabel.appendChild(this.searchInput),this.table=document.createElement("table"),this.node.appendChild(this.table),this.headings=document.createElement("tr"),this.table.appendChild(this.headings);var e=["Что","Когда","Сколько","Доля","Считать","Удалить"];for(var f=0;f<e.length;f+=1){var g=document.createElement("th");g.innerHTML=e[f],this.headings.appendChild(g)}this.headings.children[0].addEventListener("click",function(){d.sortBy("description")},!1),this.headings.children[1].addEventListener("click",function(){d.sortBy("date")},!1),this.headings.children[2].addEventListener("click",function(){d.sortBy("amount")},!1),this.headings.children[3].addEventListener("click",function(){d.sortBy("share")},!1),this.views=new a.ObservableCollection,c.expenses.each(function(b){var c=new a.ExpenseView(b);d.views.add(c)}),this.views.each(function(a){a.renderTo(d.table)}),this.views.each(function(a){a.activeAmount.notify(function(){d.updateTotalActiveAmount()}),a.on("deleteRequest",function(){d.deleteExpense(a)})}),this.updateTotalActiveAmount()},a.AppView.inheritFrom(a.BaseView),a.AppView.prototype.updateTotalActiveAmount=function(){var a=0;this.views.each(function(b){a+=b.activeAmount.get()}),this.totalActiveAmount=a,this.views.each(function(b){var c=b.activeAmount.get();b.activeShare.set(c/a)})},a.AppView.prototype.createExpense=function(){var b=this,c=this.model.createModel(),d=new a.ExpenseView(c);this.views.add(d),d.renderTo(this.table),d.activeAmount.notify(function(){b.updateTotalActiveAmount()}),d.on("deleteRequest",function(){b.deleteExpense(d)}),d.editAll()},a.AppView.prototype.deleteExpense=function(a){a.model.isActive.set(!1),a.hide(),this.views.remove(a),this.model.deleteModel(a.model)},a.AppView.prototype.sortBy=function(a){a&&(this.views.each(function(a){a.hide()}),this.views.orderBy(function(b){return a==="share"?b.activeAmount.get():b.model[a].get()},this.invertSort),this.invertSort=!this.invertSort,this.views.each(function(a){a.show()}))},a.AppView.prototype.filter=function(a){a.length>0?this.views.each(function(b){var c=b.model.description.get();c.indexOf(a)===-1?b.hide():b.show()}):this.views.each(function(a){a.show()})}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.ButtonView=function(b){var c=this;this.parentNode=null,this.listeners={},this.isVisible=!1,this.node=document.createElement("input"),this.node.type="button",this.node.innerHTML=b,this.node.addEventListener("click",function(){c.emit("press")},!1),this.text=new a.ObservableProperty(b),this.text.notify(function(){c.update()}),this.update()},a.ButtonView.inheritFrom(a.BaseView),a.ButtonView.prototype.update=function(){this.node.value=this.text.get()},a.ButtonView.prototype.getValue=function(){return this.node.value}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.DateView=function(a){var b=this;this.listeners={},this.isVisible=!1,this.prop=a,this.parentNode=null,this.node=document.createElement("p"),this.node.addEventListener("dblclick",function(){b.emit("editRequest")},!1),this.prop.notify(function(){b.update()}),this.update()},a.DateView.inheritFrom(a.BaseView),a.DateView.prototype.update=function(){var b=this.prop.get(),c=b.getDate()+" "+a.monthNames[b.getMonth()]+" "+b.getFullYear();this.node.innerHTML=c},a.DateView.prototype.getValue=function(){return this.node.innerHTML}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.EditableView=function(b,c,d,e){var f=this;this.listeners={},this.isVisible=!1,this.prop=b,this.parentNode=null,this.node=document.createElement("div"),this.viewControl=new a[c](b),d==="InputEdit"?this.editControl=new a.InputEdit(b,e):this.editControl=new a[d](b),this.viewControl.parentNode=this.node,this.editControl.parentNode=this.node,this.viewControl.on("editRequest",function(){f.edit()}),this.editControl.on("change",function(){var a=null;typeof f.editControl.inputType=="string"?f.editControl.inputType==="date"?a=new Date(f.getValue()):f.editControl.inputType==="number"?a=Number(f.getValue()):a=f.getValue():a=f.getValue(),f.prop.set(a),f.view()}),this.isEditing=!0,this.view()},a.EditableView.inheritFrom(a.BaseView),a.EditableView.prototype.view=function(){this.isEditing&&(this.editControl.hide(),this.viewControl.show(),this.isEditing=!1)},a.EditableView.prototype.edit=function(){this.isEditing||(this.viewControl.hide(),this.editControl.show(),this.isEditing=!0)},a.EditableView.prototype.getValue=function(){return this.isEditing?this.editControl.getValue():this.viewControl.getValue()}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.ExpenseView=function(b){var c=this,d=b;this.listeners={},this.isVisible=!1,this.model=b,this.parentNode=null,this.activeAmount=new a.ObservableProperty(0),this.model.amount.notify(function(){c.updateActiveAmount()}),this.model.isActive.notify(function(){c.updateActiveAmount()}),this.activeShare=new a.ObservableProperty(0),this.node=document.createElement("tr");for(var e=0;e<6;e+=1)this.node.appendChild(document.createElement("td"));this.descriptionControl=new a.EditableView(d.description,"TextView","InputEdit","text"),this.dateControl=new a.EditableView(d.date,"DateView","InputEdit","date"),this.amountControl=new a.EditableView(d.amount,"AmountView","InputEdit","number"),this.activeControl=new a.FlagView(d.isActive),this.shareControl=new a.ShareView(this.activeShare),this.descriptionControl.renderTo(this.node.children[0]),this.dateControl.renderTo(this.node.children[1]),this.amountControl.renderTo(this.node.children[2]),this.activeControl.renderTo(this.node.children[4]),this.shareControl.renderTo(this.node.children[3]),this.deleteButton=document.createElement("button"),this.deleteButton.type="button",this.deleteButton.innerHTML="Удалить",this.deleteButton.addEventListener("click",function(){c.emit("deleteRequest")},!1),this.node.children[5].appendChild(this.deleteButton),this.updateActiveAmount()},a.ExpenseView.inheritFrom(a.BaseView),a.ExpenseView.prototype.updateActiveAmount=function(){var a=this.model.isActive.get(),b=this.model.amount.get();this.activeAmount.set(a?b:0)},a.ExpenseView.prototype.editAll=function(){this.descriptionControl.edit(),this.dateControl.edit(),this.amountControl.edit()}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.FlagView=function(a){var b=this;this.listeners={},this.isVisible=!1,this.prop=a,this.parentNode=null,this.node=document.createElement("input"),this.node.type="checkbox",this.node.addEventListener("change",function(){b.prop.set(b.node.checked)},!1),this.update()},a.FlagView.inheritFrom(a.BaseView),a.FlagView.prototype.update=function(){this.node.checked=this.prop.get()},a.FlagView.prototype.getValue=function(){return this.node.checked}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.InputEdit=function(b,c){var d=this;this.listeners={},this.isVisible=!1,this.prop=b,this.parentNode=null,this.inputType=c,this.node=document.createElement("input"),this.node.type=c,this.node.addEventListener("change",function(){d.emit("change")},!1),this.node.addEventListener("keypress",function(b){b.keyCode===a.keyCodes.ENTER&&d.emit("change")},!1),this.prop.notify(function(){d.update()}),this.update()},a.InputEdit.inheritFrom(a.BaseView),a.InputEdit.prototype.update=function(){this.node.value=this.prop.get()},a.InputEdit.prototype.getValue=function(){return this.node.value}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.ShareView=function(a){var b=this;this.listeners={},this.isVisible=!1,this.prop=a,this.parentNode=null,this.node=document.createElement("p"),this.prop.notify(function(){b.update()}),this.update()},a.ShareView.inheritFrom(a.BaseView),a.ShareView.prototype.update=function(){var a=this.prop.get();isNaN(a)||a<=0?this.node.innerHTML="--":this.node.innerHTML=Math.round(a*100)+" %"},a.ShareView.prototype.getValue=function(){return this.node.innerHTML}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.TextView=function(a){var b=this;this.prop=a,this.parentNode=null,this.listeners={},this.isVisible=!1,this.node=document.createElement("p"),this.node.addEventListener("dblclick",function(){b.emit("editRequest")},!1),this.prop.notify(function(){b.update()}),this.update()},a.TextView.inheritFrom(a.BaseView),a.TextView.prototype.update=function(){this.node.innerHTML=this.prop.get()},a.TextView.prototype.getValue=function(){return this.node.innerHTML}}(),function(){"use strict",window.elist||(window.elist={});var a=window.elist;a.descriptors=[{id:1,props:{description:"Корм коту",date:new Date("8.13.2012"),amount:5}},{id:2,props:{description:"Батарейки",date:new Date("8.12.2012"),amount:3}},{id:3,props:{description:"Хот-дог",date:new Date("8.14.2012"),amount:2}},{id:4,props:{description:"Молоко",date:new Date("8.10.2012"),amount:1,isActive:!1}},{id:5,props:{description:"Интернет",date:new Date("8.9.2012"),amount:20,isActive:!1}},{id:6,props:{description:"Носки",date:new Date("8.11.2012"),amount:5,isActive:!1}}],a.ready(function(){var b=new a.AppModel(a.descriptors),c=new a.AppView(b);c.renderTo(document.body)})}();